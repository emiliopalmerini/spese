{{ define "recurrent_edit_form" }}
<div class="recurrent-item" id="recurrent-{{ .ID }}">
  <form hx-put="/recurrent/update?id={{ .ID }}" 
        hx-target="#recurrent-{{ .ID }}" 
        hx-swap="outerHTML"
        hx-indicator="#edit-loading-{{ .ID }}"
        class="recurrent-edit-form">
    
    <div class="edit-field">
      <input type="text" 
             name="description" 
             value="{{ .Description }}" 
             placeholder="Descrizione"
             maxlength="200"
             required
             class="edit-input edit-input--desc">
    </div>
    
    <div class="edit-field">
      <input type="number" 
             name="amount" 
             value="{{ printf "%.2f" (divFloat .Amount.Cents 100) }}" 
             step="0.01" 
             min="0.01"
             required
             class="edit-input edit-input--amount">
    </div>
    
    <div class="edit-field">
      <select name="repetition_type" required class="edit-select">
        <option value="daily" {{ if eq .Every "daily" }}selected{{ end }}>Giornaliera</option>
        <option value="weekly" {{ if eq .Every "weekly" }}selected{{ end }}>Settimanale</option>
        <option value="monthly" {{ if eq .Every "monthly" }}selected{{ end }}>Mensile</option>
        <option value="yearly" {{ if eq .Every "yearly" }}selected{{ end }}>Annuale</option>
      </select>
    </div>
    
    <div class="edit-field">
      <input type="date" 
             name="start_date" 
             value="{{ printf "%d-%02d-%02d" .StartDate.Year .StartDate.Month .StartDate.Day }}"
             required
             class="edit-input edit-input--date">
    </div>
    
    <div class="edit-field">
      <input type="date" 
             name="end_date" 
             value="{{ if .EndDate.Year }}{{ printf "%d-%02d-%02d" .EndDate.Year .EndDate.Month .EndDate.Day }}{{ end }}"
             class="edit-input edit-input--date">
    </div>
    
    <div class="edit-field">
      <select name="primary" required class="edit-select"
              hx-get="/api/categories/secondary"
              hx-trigger="change"
              hx-target="#secondary-{{ .ID }}"
              hx-swap="innerHTML">
        <option value="">Seleziona categoria</option>
        {{ range .Categories }}
          <option value="{{ . }}" {{ if eq . $.Primary }}selected{{ end }}>{{ . }}</option>
        {{ end }}
      </select>
    </div>
    
    <div class="edit-field">
      <select id="secondary-{{ .ID }}" name="secondary" required class="edit-select">
        {{ if .Subcats }}
          {{ range .Subcats }}
            <option value="{{ . }}" {{ if eq . $.Secondary }}selected{{ end }}>{{ . }}</option>
          {{ end }}
        {{ else }}
          <option value="{{ .Secondary }}" selected>{{ .Secondary }}</option>
        {{ end }}
      </select>
    </div>
    
    <div class="edit-actions">
      <button type="submit" class="action-icon action-icon--save" title="Salva modifiche">
        <svg viewBox="0 0 24 24">
          <path d="m9 12 2 2 4-4"/>
          <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
          <path d="M17 12c0 3-1 5-3 5s-3-2-3-5 1-5 3-5 3 2 3 5z"/>
        </svg>
      </button>
      
      <button type="button" 
              class="action-icon action-icon--cancel" 
              title="Annulla modifiche"
              onclick="window.location.reload()">
        <svg viewBox="0 0 24 24">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div id="edit-loading-{{ .ID }}" class="htmx-indicator edit-loading">
      <span>Salvando...</span>
    </div>
  </form>
</div>
{{ end }}