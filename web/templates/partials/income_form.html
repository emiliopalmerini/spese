{{/*
  Income form - redesigned for better UX
  Amount-first, single date, category chips
*/}}
{{ define "income_form" }}
<form id="income-form"
      class="form"
      hx-post="/incomes"
      hx-target="#flash"
      hx-swap="innerHTML"
      hx-indicator=".indicator"
      x-data="incomeForm()"
      x-init="init()">

  {{/* Amount - big and prominent */}}
  <div class="field field--amount">
    <label for="amount">Importo</label>
    <div class="amount-input-wrapper">
      <span class="amount-currency">â‚¬</span>
      <input
        id="amount"
        type="text"
        inputmode="decimal"
        name="amount"
        placeholder="0,00"
        required
        autocomplete="off"
        x-ref="amountInput"
        @input="formatAmount($event)"
      />
    </div>
  </div>

  {{/* Description */}}
  <div class="field">
    <label for="description">Descrizione</label>
    <input
      id="description"
      type="text"
      name="description"
      maxlength="200"
      placeholder="es. Stipendio dicembre"
      required
    />
  </div>

  {{/* Date */}}
  <div class="field">
    <label for="date">Data</label>
    <input
      id="date"
      type="date"
      name="date"
      x-model="selectedDate"
      required
    />
    <input type="hidden" name="day" :value="selectedDay" />
    <input type="hidden" name="month" :value="selectedMonth" />
  </div>

  {{/* Category chips */}}
  <div class="field" x-show="categories.length > 0">
    <label>Categoria</label>
    <div class="category-chips">
      <template x-for="cat in categories" :key="cat">
        <button
          type="button"
          class="category-chip"
          :class="{ 'active': selectedCategory === cat }"
          @click="selectCategory(cat)"
          x-text="cat"
        ></button>
      </template>
    </div>
    <input type="hidden" name="category" :value="selectedCategory" required />
  </div>

  {{/* Loading state */}}
  <div class="field" x-show="loading">
    <div class="placeholder">Caricamento categorie...</div>
  </div>

  {{/* Flash messages */}}
  <div id="flash"></div>

  {{/* Submit button */}}
  <div class="actions">
    <button
      class="btn btn-primary btn--block"
      type="submit"
      :disabled="!isValid"
    >
      Aggiungi Entrata
    </button>
    {{ template "loading_indicator" (dict "Text" "Salvataggio in corso...") }}
  </div>
</form>
{{ end }}
