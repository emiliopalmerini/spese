{{ define "recurrent_edit_form" }}
<div class="recurrent-item recurrent-item--editing" id="recurrent-{{ .ID }}">
  <form hx-put="/recurrent/update?id={{ .ID }}" 
        hx-target="#recurrent-{{ .ID }}" 
        hx-swap="outerHTML"
        hx-indicator=".edit-saving-indicator"
        class="recurrent-edit-inline">
    
    {{/* Frequency - editable inline */}}
    <select name="repetition_type" required class="recurrent-frequency recurrent-frequency--editing">
      <option value="daily" {{ if eq .Every "daily" }}selected{{ end }}>Giornaliera</option>
      <option value="weekly" {{ if eq .Every "weekly" }}selected{{ end }}>Settimanale</option>
      <option value="monthly" {{ if eq .Every "monthly" }}selected{{ end }}>Mensile</option>
      <option value="yearly" {{ if eq .Every "yearly" }}selected{{ end }}>Annuale</option>
    </select>
    
    {{/* Description - editable inline */}}
    <input type="text" 
           name="description" 
           value="{{ .Description }}" 
           maxlength="200"
           required
           class="recurrent-description recurrent-description--editing">
    
    {{/* Categories - editable inline */}}
    <div class="recurrent-categories recurrent-categories--editing">
      <select name="primary" required class="category-select category-primary--editing"
              hx-get="/api/categories/secondary"
              hx-include="this"
              hx-trigger="change"
              hx-target="#secondary-{{ .ID }}"
              hx-swap="innerHTML"
              hx-indicator="#loading-{{ .ID }}">
        <option value="">Categoria</option>
        {{ range .Categories }}
          <option value="{{ . }}" {{ if eq . $.Primary }}selected{{ end }}>{{ . }}</option>
        {{ end }}
      </select>
      <span class="category-separator">/</span>
      <select id="secondary-{{ .ID }}" name="secondary" required class="category-select category-secondary--editing">
        {{ if .Subcats }}
          {{ range .Subcats }}
            <option value="{{ . }}" {{ if eq . $.Secondary }}selected{{ end }}>{{ . }}</option>
          {{ end }}
        {{ else }}
          <option value="{{ .Secondary }}" selected>{{ .Secondary }}</option>
        {{ end }}
      </select>
      <div id="loading-{{ .ID }}" class="htmx-indicator" style="display: none; margin-top: 4px; font-size: 0.875rem; color: #6b7280;">
        Caricamento sottocategorie...
      </div>
    </div>
    
    {{/* Dates - simplified inline */}}
    <div class="recurrent-dates recurrent-dates--editing">
      <span class="date-label">Dal</span>
      <input type="date" 
             name="start_date" 
             value="{{ printf "%d-%02d-%02d" .StartDate.Year .StartDate.Month .StartDate.Day }}"
             required
             class="date-input">
      {{ if .EndDate.Year }}
        <span class="date-label">al</span>
        <input type="date" 
               name="end_date" 
               value="{{ printf "%d-%02d-%02d" .EndDate.Year .EndDate.Month .EndDate.Day }}"
               class="date-input">
      {{ else }}
        <span class="date-endless">(senza fine)</span>
        <input type="date" 
               name="end_date" 
               value=""
               placeholder="Fine (opzionale)"
               class="date-input date-input--optional">
      {{ end }}
    </div>
    
    {{/* Amount - editable inline with € symbol */}}
    <div class="recurrent-amount recurrent-amount--editing">
      <span class="amount-currency">€</span>
      <input type="number" 
             name="amount" 
             value="{{ printf "%.2f" (divFloat .Amount.Cents 100) }}" 
             step="0.01" 
             min="0.01"
             required
             class="amount-input">
    </div>
    
    {{/* Actions - refined and compact */}}
    <div class="recurrent-actions recurrent-actions--editing">
      <button type="submit" class="edit-action-btn edit-action-btn--save" title="Salva modifiche">
        <svg viewBox="0 0 24 24" class="edit-action-icon">
          <path d="m9 12 2 2 4-4"/>
        </svg>
      </button>
      
      <button type="button" 
              class="edit-action-btn edit-action-btn--cancel" 
              title="Annulla modifiche"
              hx-get="/ui/recurrent-expenses-list" 
              hx-target="#recurrent-list" 
              hx-swap="outerHTML">
        <svg viewBox="0 0 24 24" class="edit-action-icon">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
      
      <div class="edit-saving-indicator htmx-indicator">
        <div class="saving-spinner"></div>
      </div>
    </div>
  </form>
</div>
{{ end }}